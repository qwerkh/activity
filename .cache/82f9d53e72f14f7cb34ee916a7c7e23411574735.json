{"metadata":{},"options":{"compact":false,"sourceMaps":true,"ast":true,"babelrc":false,"configFile":false,"parserOpts":{"sourceType":"module","sourceFileName":"/home/snr/Desktop/Project/activity/imports/vue/ui/loanRepaymentForm.vue","plugins":["*","flow","jsx","asyncGenerators","bigInt","classPrivateMethods","classPrivateProperties","classProperties","doExpressions","dynamicImport","exportDefaultFrom","exportExtensions","exportNamespaceFrom","functionBind","functionSent","importMeta","nullishCoalescingOperator","numericSeparator","objectRestSpread","optionalCatchBinding","optionalChaining",["pipelineOperator",{"proposal":"minimal"}],"throwExpressions","dynamicImport",["flow",{}],"asyncGenerators","objectRestSpread","objectRestSpread",["flow",{}],"asyncGenerators"],"allowImportExportEverywhere":true,"allowReturnOutsideFunction":true,"strictMode":false},"sourceFileName":"/home/snr/Desktop/Project/activity/imports/vue/ui/loanRepaymentForm.vue","filename":"/home/snr/Desktop/Project/activity/imports/vue/ui/loanRepaymentForm.vue","passPerPreset":false,"envName":"development","cwd":"/home/snr/Desktop/Project/activity","root":"/home/snr/Desktop/Project/activity","plugins":[{"key":"base$0$0","visitor":{"Program":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"generateLetDeclarations":true,"enforceStrictMode":false}},{"key":"transform-meteor-dynamic-import","visitor":{"_exploded":{},"_verified":{},"CallExpression":{"enter":[null]}},"options":{}},{"key":"transform-runtime","visitor":{"CallExpression":{"enter":[null]},"BinaryExpression":{"enter":[null]},"MemberExpression":{"enter":[null],"exit":[null]},"_exploded":true,"_verified":true,"Identifier":{"enter":[null]},"JSXIdentifier":{"enter":[null]}},"options":{}},{"key":"transform-modules-commonjs","visitor":{"Program":{"exit":[null]},"_exploded":true,"_verified":true},"options":{"allowTopLevelThis":true,"strictMode":false,"loose":true}},{"key":"syntax-flow","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"syntax-async-generators","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"transform-arrow-functions","visitor":{"ArrowFunctionExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-block-scoped-functions","visitor":{"BlockStatement":{"enter":[null]},"SwitchCase":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-block-scoping","visitor":{"VariableDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"_exploded":true,"BlockStatement":{"enter":[null]},"SwitchStatement":{"enter":[null]},"Program":{"enter":[null]},"_verified":true,"DoWhileStatement":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForStatement":{"enter":[null]},"WhileStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]}},"options":{}},{"key":"transform-classes","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"ClassDeclaration":{"enter":[null]},"ClassExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"loose":true}},{"key":"transform-computed-properties","visitor":{"ObjectExpression":{"exit":[null]},"_exploded":true,"_verified":true},"options":{"loose":true}},{"key":"transform-destructuring","visitor":{"ExportNamedDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"AssignmentExpression":{"enter":[null]},"VariableDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ForInStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]}},"options":{}},{"key":"transform-for-of","visitor":{"ForOfStatement":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"loose":true}},{"key":"transform-literals","visitor":{"NumericLiteral":{"enter":[null]},"StringLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-object-super","visitor":{"ObjectExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-parameters","visitor":{"_exploded":true,"_verified":true,"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]}},"options":{}},{"key":"transform-shorthand-properties","visitor":{"ObjectMethod":{"enter":[null]},"ObjectProperty":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-spread","visitor":{"ArrayExpression":{"enter":[null]},"CallExpression":{"enter":[null]},"NewExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-sticky-regex","visitor":{"RegExpLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-template-literals","visitor":{"TaggedTemplateExpression":{"enter":[null]},"TemplateLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"loose":true}},{"key":"transform-typeof-symbol","visitor":{"UnaryExpression":{"enter":[null]},"_exploded":true,"_verified":true,"BlockStatement":{"enter":[null]},"CatchClause":{"enter":[null]},"DoWhileStatement":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForStatement":{"enter":[null]},"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"Program":{"enter":[null]},"ObjectMethod":{"enter":[null]},"SwitchStatement":{"enter":[null]},"WhileStatement":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]},"ClassExpression":{"enter":[null]},"ForOfStatement":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]}},"options":{}},{"key":"transform-unicode-regex","visitor":{"RegExpLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"syntax-object-rest-spread","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-object-rest-spread","visitor":{"_exploded":{},"_verified":{},"VariableDeclarator":{"enter":[null]},"ExportNamedDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"AssignmentExpression":{"enter":[null]},"ObjectExpression":{"enter":[null]},"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]}},"options":{}},{"key":"transform-property-literals","visitor":{"ObjectProperty":{"exit":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-flow-strip-types","visitor":{"_exploded":{},"_verified":{},"Program":{"enter":[null]},"ImportDeclaration":{"enter":[null,null]},"ClassProperty":{"enter":[null]},"ClassPrivateProperty":{"enter":[null]},"AssignmentPattern":{"enter":[null]},"TypeCastExpression":{"enter":[null,null]},"CallExpression":{"enter":[null]},"OptionalCallExpression":{"enter":[null]},"NewExpression":{"enter":[null]},"ImportSpecifier":{"enter":[null]},"ClassDeclaration":{"enter":[null]},"ClassExpression":{"enter":[null]},"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]},"AnyTypeAnnotation":{"enter":[null]},"ArrayTypeAnnotation":{"enter":[null]},"BooleanTypeAnnotation":{"enter":[null]},"BooleanLiteralTypeAnnotation":{"enter":[null]},"NullLiteralTypeAnnotation":{"enter":[null]},"ClassImplements":{"enter":[null]},"DeclareClass":{"enter":[null]},"DeclareFunction":{"enter":[null]},"DeclareInterface":{"enter":[null]},"DeclareModule":{"enter":[null]},"DeclareModuleExports":{"enter":[null]},"DeclareTypeAlias":{"enter":[null]},"DeclareOpaqueType":{"enter":[null]},"DeclareVariable":{"enter":[null]},"DeclareExportDeclaration":{"enter":[null]},"DeclareExportAllDeclaration":{"enter":[null]},"DeclaredPredicate":{"enter":[null]},"ExistsTypeAnnotation":{"enter":[null]},"FunctionTypeAnnotation":{"enter":[null]},"FunctionTypeParam":{"enter":[null]},"GenericTypeAnnotation":{"enter":[null]},"InferredPredicate":{"enter":[null]},"InterfaceExtends":{"enter":[null]},"InterfaceDeclaration":{"enter":[null]},"InterfaceTypeAnnotation":{"enter":[null]},"IntersectionTypeAnnotation":{"enter":[null]},"MixedTypeAnnotation":{"enter":[null]},"EmptyTypeAnnotation":{"enter":[null]},"NullableTypeAnnotation":{"enter":[null]},"NumberLiteralTypeAnnotation":{"enter":[null]},"NumberTypeAnnotation":{"enter":[null]},"ObjectTypeAnnotation":{"enter":[null]},"ObjectTypeInternalSlot":{"enter":[null]},"ObjectTypeCallProperty":{"enter":[null]},"ObjectTypeIndexer":{"enter":[null]},"ObjectTypeProperty":{"enter":[null]},"ObjectTypeSpreadProperty":{"enter":[null]},"OpaqueType":{"enter":[null]},"QualifiedTypeIdentifier":{"enter":[null]},"StringLiteralTypeAnnotation":{"enter":[null]},"StringTypeAnnotation":{"enter":[null]},"ThisTypeAnnotation":{"enter":[null]},"TupleTypeAnnotation":{"enter":[null]},"TypeofTypeAnnotation":{"enter":[null]},"TypeAlias":{"enter":[null]},"TypeAnnotation":{"enter":[null]},"TypeParameter":{"enter":[null]},"TypeParameterDeclaration":{"enter":[null]},"TypeParameterInstantiation":{"enter":[null]},"UnionTypeAnnotation":{"enter":[null]},"Variance":{"enter":[null]},"VoidTypeAnnotation":{"enter":[null]},"ExportAllDeclaration":{"enter":[null]},"ExportDefaultDeclaration":{"enter":[null]},"ExportNamedDeclaration":{"enter":[null]}},"options":{}},{"key":"transform-exponentiation-operator","visitor":{"AssignmentExpression":{"enter":[null]},"BinaryExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-async-generator-functions","visitor":{"_exploded":{},"_verified":{},"Program":{"enter":[null]}},"options":{}},{"key":"regenerator-transform","visitor":{"_exploded":true,"_verified":true,"FunctionDeclaration":{"exit":[null]},"FunctionExpression":{"exit":[null]},"ObjectMethod":{"exit":[null]},"ArrowFunctionExpression":{"exit":[null]},"ClassMethod":{"exit":[null]},"ClassPrivateMethod":{"exit":[null]}},"options":{}}],"presets":[],"generatorOpts":{"filename":"/home/snr/Desktop/Project/activity/imports/vue/ui/loanRepaymentForm.vue","comments":true,"compact":false,"sourceMaps":true,"sourceFileName":"/home/snr/Desktop/Project/activity/imports/vue/ui/loanRepaymentForm.vue"}},"code":"var compoLang;\nmodule.link(\"../../../both/i18n/lang/elem-label-loan\", {\n  \"default\": function (v) {\n    compoLang = v;\n  }\n}, 0);\nvar Loan_RepaymentReact;\nmodule.link(\"../../collection/loanRepayment\", {\n  Loan_RepaymentReact: function (v) {\n    Loan_RepaymentReact = v;\n  }\n}, 1);\nvar formatCurrency;\nmodule.link(\"../../../imports/api/methods/roundCurrency\", {\n  formatCurrency: function (v) {\n    formatCurrency = v;\n  }\n}, 2);\nvar formatCurrencyLast;\nmodule.link(\"../../../imports/api/methods/roundCurrency\", {\n  formatCurrencyLast: function (v) {\n    formatCurrencyLast = v;\n  }\n}, 3);\nvar GeneralFunction;\nmodule.link(\"../../../imports/api/methods/generalFunction\", {\n  GeneralFunction: function (v) {\n    GeneralFunction = v;\n  }\n}, 4);\nvar getCurrencySymbolById;\nmodule.link(\"../../../imports/api/methods/roundCurrency\", {\n  getCurrencySymbolById: function (v) {\n    getCurrencySymbolById = v;\n  }\n}, 5);\nvar WB_waterBillingSetup;\nmodule.link(\"../../collection/waterBillingSetup\", {\n  WB_waterBillingSetup: function (v) {\n    WB_waterBillingSetup = v;\n  }\n}, 6);\nvar Manage_Module;\nmodule.link(\"../../collection/manageModule\", {\n  Manage_Module: function (v) {\n    Manage_Module = v;\n  }\n}, 7);\nvar math;\nmodule.link(\"mathjs\", {\n  \"default\": function (v) {\n    math = v;\n  }\n}, 8);\nmodule.exportDefault({\n  meteor: {\n    langSession: function () {\n      return Session.get('lang') || \"en\";\n    },\n    disabledRemove: function () {\n      return Session.get(\"canRemove\");\n    },\n    disabledUpdate: function () {\n      return Session.get(\"canUpdate\");\n    },\n    newRe: function () {\n      var vm = this;\n      Loan_RepaymentReact.find({}).fetch();\n    }\n  },\n  mounted: function () {\n    this.$jQuery('body').off();\n    this.$jQuery('body').on('focus', 'input[type=number]', function (e) {\n      $(this).on('wheel', function (e) {\n        e.preventDefault();\n      });\n    });\n  },\n  data: function () {\n    return {\n      langSession: null,\n      loanRepaymentForm: {\n        disbursementId: \"\",\n        currencyId: \"\",\n        repaymentDate: moment().toDate(),\n        paid: 0,\n        penalty: 0,\n        penaltyPaid: 0,\n        voucher: \"\",\n        note: \"\",\n        clientId: \"\",\n        type: \"Repayment\",\n        interestPaid: 0,\n        operationFeePaid: 0,\n        interestReminderChargePaid: 0,\n        interestReminderCharge: 0,\n        _id: \"\"\n      },\n      rules: {},\n      disbursementOption: [],\n      currencyOption: [{\n        label: \"USD\",\n        value: \"USD\"\n      }, {\n        label: \"KHR\",\n        value: \"KHR\"\n      }, {\n        label: \"THB\",\n        value: \"THB\"\n      }],\n      typeIdentity: \"Identity Card\",\n      repaymentDoc: {},\n      skip: 0,\n      currencySymbol: \"\",\n      currencyId: \"\",\n      dayLate: 0,\n      balance: 0,\n      balanceNeedToPaidShow: 0,\n      isFee: false,\n      isPrepay: false,\n      isPayOff: false,\n      isDisablePenalty: false,\n      isDisablePaid: false,\n      isPenaltyMinusGraceDay: true,\n      interestReminder: 0,\n      interestReminderSumDay: 0,\n      operationFeeReminder: 0,\n      isOperationFee: false\n    };\n  },\n  watch: {\n    \"loanRepaymentForm.disbursementId\": function (val) {\n      this.getDisbursementById(val);\n    },\n    \"loanRepaymentForm.repaymentDate\": function (val) {\n      this.getVoucherByRoleAndDate(val);\n      this.loanRepaymentForm.repaymentDate = val;\n      this.getDisbursementById(this.loanRepaymentForm.disbursementId);\n    },\n    \"loanRepaymentForm.type\": function (val) {\n      this.loanRepaymentForm.type = val;\n      this.getDisbursementById(this.loanRepaymentForm.disbursementId);\n    }\n  },\n  methods: {\n    customerOpt: function (query) {\n      var _this = this;\n\n      if (!!query) {\n        setTimeout(function () {\n          Meteor.call('queryLoanDisbursementOption', query, Session.get(\"area\"), function (err, result) {\n            if (!err) {\n              _this.disbursementOption = result;\n            } else {\n              console.log(err.message);\n            }\n          });\n        }, 200);\n      } else {\n        Meteor.call('queryLoanDisbursementOption', \"\", Session.get(\"area\"), function (err, result) {\n          if (!err) {\n            _this.disbursementOption = result;\n          } else {\n            console.log(err.message);\n          }\n        });\n      }\n    },\n    getCalculateAmountPaid: function (disbursementId) {\n      var _this2 = this;\n\n      var vm = this;\n      Meteor.call(\"getAmountNeedToPaid\", disbursementId, moment(vm.loanRepaymentForm.repaymentDate).endOf(\"day\").toDate(), function (err, result) {\n        if (result) {\n          vm.repaymentDoc = result;\n          vm.typeIdentity = result && result.clientDoc && result.clientDoc.type || \"Identity Card\";\n          vm.loanRepaymentForm.clientId = result.clientId;\n\n          if (vm.loanRepaymentForm.repaymentDate && result.date) {\n            vm.dayLate = moment(vm.loanRepaymentForm.repaymentDate).startOf(\"days\").add(12, \"hours\").diff(result.date, \"days\");\n          }\n\n          vm.dayLate = vm.dayLate > 0 ? vm.dayLate : 0;\n\n          if (result && result.penaltyDoc && vm.dayLate > result.penaltyDoc.graceDay) {\n            var penaltyPerday;\n\n            if (result.currencyId === \"USD\") {\n              penaltyPerday = result.penaltyDoc.amountUSD;\n            } else if (result.currencyId === \"KHR\") {\n              penaltyPerday = result.penaltyDoc.amountKHR;\n            } else if (result.currencyId === \"THB\") {\n              penaltyPerday = result.penaltyDoc.amountTHB;\n            }\n\n            if (_this2.isPenaltyMinusGraceDay === true) {\n              if (result.penaltyDoc.type === \"A\") {\n                vm.loanRepaymentForm.penalty = formatCurrencyLast((vm.dayLate - result.penaltyDoc.graceDay) * penaltyPerday, result.currencyId);\n              } else if (result.penaltyDoc.type === \"P\") {\n                vm.loanRepaymentForm.penalty = formatCurrencyLast((vm.dayLate - result.penaltyDoc.graceDay) * (penaltyPerday * result.principleUnpaid / 100), result.currencyId);\n              }\n            } else {\n              if (result.penaltyDoc.type === \"A\") {\n                vm.loanRepaymentForm.penalty = formatCurrencyLast(vm.dayLate * penaltyPerday, result.currencyId);\n              } else if (result.penaltyDoc.type === \"P\") {\n                vm.loanRepaymentForm.penalty = formatCurrencyLast(vm.dayLate * (penaltyPerday * result.principleUnpaid / 100), result.currencyId);\n              }\n            }\n          } else {\n            vm.loanRepaymentForm.penalty = 0;\n          }\n\n          vm.currencySymbol = getCurrencySymbolById(result && result.currencyId);\n          vm.currencyId = result.currencyId;\n          vm.loanRepaymentForm.penaltyPaid = vm.$_numeral(vm.loanRepaymentForm.penalty).value();\n          vm.loanRepaymentForm.paid = vm.$_numeral(formatCurrencyLast(result.balanceUnpaid || 0, result.currencyId)).value();\n\n          _this2.getTotal();\n        }\n      });\n    },\n    getCalculatePrepayPaid: function (disbursementId) {\n      var _this3 = this;\n\n      var vm = this;\n      Meteor.call(\"getPrepayToPaid\", disbursementId, moment(vm.loanRepaymentForm.repaymentDate).endOf(\"day\").toDate(), function (err, result) {\n        if (result) {\n          vm.isPrepay = true;\n          vm.repaymentDoc = result;\n          vm.typeIdentity = result && result.clientDoc && result.clientDoc.type || \"Identity Card\";\n          vm.loanRepaymentForm.clientId = result.clientId;\n          vm.dayLate = 0;\n          vm.loanRepaymentForm.penalty = 0;\n          vm.currencySymbol = getCurrencySymbolById(result && result.currencyId);\n          vm.currencyId = result.currencyId;\n          vm.loanRepaymentForm.penaltyPaid = 0;\n          vm.loanRepaymentForm.paid = vm.$_numeral(formatCurrencyLast(result.balanceUnpaid || 0, result.currencyId)).value();\n\n          _this3.getTotal();\n        }\n      });\n    },\n    getCalculateClosingPaid: function (disbursementId) {\n      var _this4 = this;\n\n      var vm = this;\n      Meteor.call(\"getClosingPaid\", disbursementId, moment(vm.loanRepaymentForm.repaymentDate).endOf(\"day\").toDate(), function (err, result) {\n        if (result) {\n          vm.repaymentDoc = result;\n          vm.typeIdentity = result && result.clientDoc && result.clientDoc.type || \"Identity Card\";\n          vm.loanRepaymentForm.clientId = result.clientId;\n          vm.loanRepaymentForm.penalty = 0;\n          vm.currencySymbol = getCurrencySymbolById(result && result.currencyId);\n          vm.currencyId = result.currencyId;\n          var totalPayOff = 0;\n          totalPayOff += result.principleUnpaid || 0;\n\n          if (result.isAllowClosing === false) {\n            var penaltyInterest = result.penaltyClosingDoc.interestReminderCharge * result.interestUnpaid / 100;\n            vm.loanRepaymentForm.interestReminderChargePaid = vm.$_numeral(formatCurrencyLast(penaltyInterest, result.currencyId)).value();\n            vm.loanRepaymentForm.interestReminderCharge = formatCurrencyLast(penaltyInterest, result.currencyId);\n          }\n\n          if (vm.loanRepaymentForm.repaymentDate && result.date) {\n            vm.dayLate = moment(vm.loanRepaymentForm.repaymentDate).startOf(\"days\").add(12, \"hours\").diff(result.date, \"days\");\n          }\n\n          var interestPerDay = result.interestReminder / result.dayRange;\n          var dayForInterest = vm.dayLate > 0 ? result.dayRange : result.dayRange + vm.dayLate;\n          vm.dayLate = vm.dayLate > 0 ? vm.dayLate : 0;\n          var intRemind = 0;\n          var countFirstUnpaid = 0;\n          result.scheduleList.forEach(function (obj) {\n            var dayLateInLine = moment(vm.loanRepaymentForm.repaymentDate).startOf(\"days\").add(12, \"hours\").diff(obj.date, \"days\");\n\n            if (dayLateInLine > 0) {\n              var _interestPerDay = obj.interestUnpaid / obj.dayRange;\n\n              intRemind += _interestPerDay * dayLateInLine;\n            }\n\n            if (obj.isPaid === false && countFirstUnpaid === 0) {\n              vm.operationFeeReminder = obj.operationFeeUnpaid;\n              countFirstUnpaid++;\n            }\n          });\n          dayForInterest = dayForInterest > 0 ? dayForInterest : 0;\n          vm.interestReminder = result.interestReminder + intRemind;\n          vm.interestReminderSumDay = interestPerDay * dayForInterest + intRemind;\n          vm.interestReminder = formatCurrencyLast(vm.repaymentDoc.interestUnpaid > vm.interestReminder ? vm.interestReminder : vm.repaymentDoc.interestUnpaid, result.currencyId);\n          vm.interestReminderSumDay = formatCurrencyLast(vm.repaymentDoc.interestUnpaid > vm.interestReminderSumDay ? vm.interestReminderSumDay : vm.repaymentDoc.interestUnpaid, result.currencyId);\n          vm.loanRepaymentForm.interestPaid = vm.$_numeral(formatCurrencyLast(vm.interestReminder, result.currencyId)).value();\n          vm.loanRepaymentForm.operationFeePaid = vm.operationFeeReminder;\n\n          if (result && result.penaltyDoc && vm.dayLate > result.penaltyDoc.graceDay) {\n            var penaltyPerday;\n\n            if (result.currencyId === \"USD\") {\n              penaltyPerday = result.penaltyDoc.amountUSD;\n            } else if (result.currencyId === \"KHR\") {\n              penaltyPerday = result.penaltyDoc.amountKHR;\n            } else if (result.currencyId === \"THB\") {\n              penaltyPerday = result.penaltyDoc.amountTHB;\n            }\n\n            if (result.penaltyDoc.type === \"A\") {\n              vm.loanRepaymentForm.penalty = formatCurrencyLast((vm.dayLate - result.penaltyDoc.graceDay) * penaltyPerday, result.currencyId);\n            } else if (result.penaltyDoc.type === \"P\") {\n              vm.loanRepaymentForm.penalty = formatCurrencyLast((vm.dayLate - result.penaltyDoc.graceDay) * (penaltyPerday * result.principleUnpaid / 100), result.currencyId);\n            }\n          } else {\n            vm.loanRepaymentForm.penalty = 0;\n          }\n\n          vm.loanRepaymentForm.penaltyPaid = vm.$_numeral(vm.loanRepaymentForm.penalty).value();\n          vm.loanRepaymentForm.paid = vm.$_numeral(formatCurrencyLast(totalPayOff, result.currencyId)).value();\n\n          _this4.getTotal();\n        }\n      });\n    },\n    getCalculateWriteOff: function (disbursementId) {\n      var _this5 = this;\n\n      var vm = this;\n      Meteor.call(\"getWriteOff\", disbursementId, moment(vm.loanRepaymentForm.repaymentDate).endOf(\"day\").toDate(), function (err, result) {\n        if (result) {\n          vm.repaymentDoc = result;\n          vm.typeIdentity = result && result.clientDoc && result.clientDoc.type || \"Identity Card\";\n          vm.loanRepaymentForm.clientId = result.clientId;\n\n          if (vm.loanRepaymentForm.repaymentDate && result.date) {\n            vm.dayLate = moment(vm.loanRepaymentForm.repaymentDate).startOf(\"days\").add(12, \"hours\").diff(result.date, \"days\");\n          }\n\n          vm.dayLate = vm.dayLate > 0 ? vm.dayLate : 0;\n          vm.currencySymbol = getCurrencySymbolById(result && result.currencyId);\n          vm.currencyId = result.currencyId;\n          vm.loanRepaymentForm.penaltyPaid = 0;\n          vm.loanRepaymentForm.paid = vm.$_numeral(formatCurrencyLast(result.balanceUnpaid || 0, result.currencyId)).value();\n\n          _this5.getTotal();\n        }\n      });\n    },\n    getCalculateFeePaid: function (disbursementId) {\n      var vm = this;\n      Meteor.call(\"getFeeNeedToPaid\", disbursementId, function (err, result) {\n        if (result) {\n          vm.repaymentDoc = result;\n          vm.typeIdentity = result && result.clientDoc && result.clientDoc.type || \"Identity Card\";\n          vm.loanRepaymentForm.clientId = result.clientId;\n          vm.dayLate = 0;\n          vm.loanRepaymentForm.penalty = 0;\n          vm.currencySymbol = getCurrencySymbolById(result && result.currencyId);\n          vm.currencyId = result.currencyId;\n          vm.loanRepaymentForm.paid = vm.$_numeral(formatCurrencyLast(result.feeAmount || 0, result.currencyId)).value();\n          vm.getTotal();\n        }\n      });\n    },\n    getTotal: function () {\n      var vm = this;\n      vm.balanceNeedToPaidShow = formatCurrencyLast((vm.loanRepaymentForm.operationFeePaid || 0) + (vm.loanRepaymentForm.penaltyPaid || 0) + (vm.loanRepaymentForm.paid || 0) + (vm.loanRepaymentForm.interestPaid || 0) + (vm.loanRepaymentForm.interestReminderChargePaid || 0), vm.repaymentDoc.currencyId);\n    },\n    getVoucherByRoleAndDate: function (date) {\n      var vm = this;\n      Meteor.call(\"loan_getVoucherNoByRoleAndDate\", Session.get(\"area\"), date, function (err, result) {\n        if (!err) {\n          vm.loanRepaymentForm.voucher = result;\n        }\n      });\n    },\n    getDisbursementById: function (id) {\n      var vm = this;\n      Meteor.call(\"queryLoanDisbursementById\", id, function (err, result) {\n        if (result) {\n          vm.isFee = math.round(result.feeAmount - result.paidFeeAmount) > 0;\n\n          if (vm.isFee === true) {\n            vm.repaymentDoc.disbursementDoc = result;\n            vm.dayLate = 0;\n            vm.getCalculateFeePaid(id);\n            vm.loanRepaymentForm.type = \"Fee\";\n            vm.isDisablePaid = true;\n            vm.isDisablePenalty = true;\n          } else {\n            if (vm.loanRepaymentForm.type === \"Repayment\") {\n              vm.getCalculateAmountPaid(id);\n              vm.isDisablePaid = false;\n              vm.isDisablePenalty = false;\n              vm.isPayOff = false;\n              vm.isPrepay = false;\n              vm.loanRepaymentForm.operationFeePaid = 0;\n              vm.loanRepaymentForm.interestPaid = 0;\n              vm.loanRepaymentForm.interestReminderCharge = 0;\n              vm.loanRepaymentForm.interestReminderChargePaid = 0;\n            } else if (vm.loanRepaymentForm.type === \"Write Off\") {\n              vm.getCalculateWriteOff(id);\n              vm.isDisablePaid = true;\n              vm.isDisablePenalty = true;\n              vm.isPayOff = false;\n              vm.isPrepay = false;\n              vm.loanRepaymentForm.type = \"Write Off\";\n              vm.loanRepaymentForm.operationFeePaid = 0;\n              vm.loanRepaymentForm.interestPaid = 0;\n              vm.loanRepaymentForm.interestReminderCharge = 0;\n              vm.loanRepaymentForm.interestReminderChargePaid = 0;\n            } else if (vm.loanRepaymentForm.type === \"Prepay\") {\n              vm.isDisablePaid = false;\n              vm.isDisablePenalty = true;\n              vm.getCalculatePrepayPaid(id);\n              vm.isPayOff = false;\n              vm.isPrepay = true;\n              vm.loanRepaymentForm.operationFeePaid = 0;\n              vm.loanRepaymentForm.interestPaid = 0;\n              vm.loanRepaymentForm.interestReminderCharge = 0;\n              vm.loanRepaymentForm.interestReminderChargePaid = 0;\n            } else if (vm.loanRepaymentForm.type === \"Pay Off\") {\n              vm.getCalculateClosingPaid(id);\n              vm.isDisablePaid = true;\n              vm.isDisablePenalty = false;\n              vm.loanRepaymentForm.type = \"Pay Off\";\n              vm.isPayOff = true;\n              vm.isPrepay = false;\n            } else {\n              if (vm.isFee === false) {\n                vm.getCalculateAmountPaid(id);\n                vm.loanRepaymentForm.type = \"Repayment\";\n                vm.isDisablePaid = false;\n                vm.isDisablePenalty = false;\n                vm.isPayOff = false;\n                vm.isPrepay = false;\n                vm.loanRepaymentForm.operationFeePaid = 0;\n                vm.loanRepaymentForm.interestPaid = 0;\n                vm.loanRepaymentForm.interestReminderCharge = 0;\n                vm.loanRepaymentForm.interestReminderChargePaid = 0;\n              }\n            }\n          }\n        }\n      });\n    },\n    saveLoanRepayment: function (event) {\n      var _this6 = this;\n\n      event.preventDefault();\n      var vm = this;\n\n      if (vm.loanRepaymentForm.type === \"Pay Off\") {\n        if (vm.dayLate > 0 && vm.repaymentDoc.installmentList.length != 1) {\n          vm.$message({\n            duration: 5000,\n            message: this.langConfig['cannotPayOffThisTime'],\n            type: 'error'\n          });\n          return false;\n        }\n      }\n\n      this.$refs[\"loanRepaymentForm\"].validate(function (valid) {\n        if (valid) {\n          var loanRepaymentDoc = {\n            disbursementId: vm.loanRepaymentForm.disbursementId,\n            currencyId: vm.repaymentDoc.currencyId,\n            repaymentDate: moment(vm.loanRepaymentForm.repaymentDate).startOf(\"days\").add(12, \"hours\").toDate(),\n            remain: vm.$_numeral(vm.loanRepaymentForm.remain).value(),\n            penalty: vm.$_numeral(vm.loanRepaymentForm.penalty).value(),\n            penaltyPaid: vm.$_numeral(vm.loanRepaymentForm.penaltyPaid).value(),\n            voucher: vm.loanRepaymentForm.voucher,\n            note: vm.loanRepaymentForm.note,\n            type: vm.loanRepaymentForm.type,\n            dayLate: vm.dayLate,\n            interestReminderCharge: vm.$_numeral(vm.loanRepaymentForm.interestReminderCharge).value(),\n            interestReminderChargePaid: vm.$_numeral(vm.loanRepaymentForm.interestReminderChargePaid).value(),\n            interestPaid: vm.$_numeral(vm.loanRepaymentForm.interestPaid).value(),\n            operationFeePaid: vm.$_numeral(vm.loanRepaymentForm.operationFeePaid).value(),\n            clientId: vm.loanRepaymentForm.clientId,\n            paid: vm.$_numeral(vm.loanRepaymentForm.paid).value(),\n            totalPaid: vm.$_numeral(vm.loanRepaymentForm.paid + vm.loanRepaymentForm.penaltyPaid + vm.loanRepaymentForm.interestReminderChargePaid + vm.loanRepaymentForm.interestPaid + vm.loanRepaymentForm.operationFeePaid).value(),\n            rolesArea: Session.get('area')\n          };\n          Meteor.call(\"insertLoanRepayment\", loanRepaymentDoc, function (err, result) {\n            if (!err) {\n              vm.$message({\n                duration: 1000,\n                message: _this6.langConfig['saveSuccess'],\n                type: 'success'\n              });\n              vm.resetForm();\n            } else {\n              vm.$message({\n                duration: 1000,\n                message: err.message,\n                type: 'error'\n              });\n            }\n          });\n        }\n      });\n    },\n    getRemainAmountByCurrency: function (currency, usd, khr, thb) {\n      if (currency === \"USD\") {\n        return usd;\n      } else if (currency === \"KHR\") {\n        return khr;\n      } else if (currency === \"THB\") {\n        return thb;\n      }\n    },\n    cancel: function () {\n      this.$message({\n        type: 'info',\n        message: this.langConfig['cancel']\n      });\n    },\n    resetForm: function () {\n      this.loanRepaymentForm.disbursementId = \"\";\n      this.loanRepaymentForm.repaymentDate = moment().toDate();\n      this.loanRepaymentForm.paid = 0;\n      this.loanRepaymentForm.remain = 0;\n      this.loanRepaymentForm.penalty = 0;\n      this.loanRepaymentForm.penaltyPaid = 0;\n      this.balanceNeedToPaidShow = 0;\n      this.loanRepaymentForm.interestPaid = 0;\n      this.loanRepaymentForm.operationFeePaid = 0;\n      this.loanRepaymentForm.interestReminderCharge = 0;\n      this.loanRepaymentForm.interestReminderChargePaid = 0;\n      this.interestReminder = 0;\n      this.loanRepaymentForm.note = \"\";\n      this.repaymentDoc = {};\n    }\n  },\n  created: function () {\n    this.customerOpt();\n    this.getVoucherByRoleAndDate(moment().toDate());\n    var setupDoc = WB_waterBillingSetup.findOne({});\n    this.isOperationFee = setupDoc.isOperationFee;\n    this.isPenaltyMinusGraceDay = setupDoc.isPenaltyMinusGraceDay;\n  },\n  computed: {\n    langConfig: function () {\n      var _this7 = this;\n\n      var data = compoLang.filter(function (config) {\n        return config.lang === _this7.langSession;\n      })[0]['repayment'];\n      return data;\n    }\n  }\n});","map":{"version":3,"sources":["/home/snr/Desktop/Project/activity/imports/vue/ui/loanRepaymentForm.vue"],"names":["compoLang","module","link","v","Loan_RepaymentReact","formatCurrency","formatCurrencyLast","GeneralFunction","getCurrencySymbolById","WB_waterBillingSetup","Manage_Module","math","exportDefault","meteor","langSession","Session","get","disabledRemove","disabledUpdate","newRe","vm","find","fetch","mounted","$jQuery","off","on","e","$","preventDefault","data","loanRepaymentForm","disbursementId","currencyId","repaymentDate","moment","toDate","paid","penalty","penaltyPaid","voucher","note","clientId","type","interestPaid","operationFeePaid","interestReminderChargePaid","interestReminderCharge","_id","rules","disbursementOption","currencyOption","label","value","typeIdentity","repaymentDoc","skip","currencySymbol","dayLate","balance","balanceNeedToPaidShow","isFee","isPrepay","isPayOff","isDisablePenalty","isDisablePaid","isPenaltyMinusGraceDay","interestReminder","interestReminderSumDay","operationFeeReminder","isOperationFee","watch","val","getDisbursementById","getVoucherByRoleAndDate","methods","customerOpt","query","setTimeout","Meteor","call","err","result","console","log","message","getCalculateAmountPaid","endOf","clientDoc","date","startOf","add","diff","penaltyDoc","graceDay","penaltyPerday","amountUSD","amountKHR","amountTHB","principleUnpaid","$_numeral","balanceUnpaid","getTotal","getCalculatePrepayPaid","getCalculateClosingPaid","totalPayOff","isAllowClosing","penaltyInterest","penaltyClosingDoc","interestUnpaid","interestPerDay","dayRange","dayForInterest","intRemind","countFirstUnpaid","scheduleList","forEach","obj","dayLateInLine","isPaid","operationFeeUnpaid","getCalculateWriteOff","getCalculateFeePaid","feeAmount","id","round","paidFeeAmount","disbursementDoc","saveLoanRepayment","event","installmentList","length","$message","duration","langConfig","$refs","validate","valid","loanRepaymentDoc","remain","totalPaid","rolesArea","resetForm","getRemainAmountByCurrency","currency","usd","khr","thb","cancel","created","setupDoc","findOne","computed","filter","config","lang"],"mappings":"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","sourcesContent":["//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n\nimport compoLang from '../../../both/i18n/lang/elem-label-loan'\nimport {Loan_RepaymentReact} from \"../../collection/loanRepayment\";\nimport {formatCurrency} from \"../../../imports/api/methods/roundCurrency\";\nimport {formatCurrencyLast} from \"../../../imports/api/methods/roundCurrency\";\nimport {GeneralFunction} from \"../../../imports/api/methods/generalFunction\";\nimport {getCurrencySymbolById} from \"../../../imports/api/methods/roundCurrency\";\nimport {WB_waterBillingSetup} from \"../../collection/waterBillingSetup\";\nimport {Manage_Module} from \"../../collection/manageModule\";\nimport math from \"mathjs\";\n\nexport default {\n    meteor: {\n        langSession() {\n            return Session.get('lang') || \"en\";\n        },\n        disabledRemove() {\n            return Session.get(\"canRemove\");\n        },\n        disabledUpdate() {\n            return Session.get(\"canUpdate\");\n        },\n        newRe() {\n            let vm = this;\n            Loan_RepaymentReact.find({}).fetch();\n        }\n    },\n    mounted() {\n        this.$jQuery('body').off();\n        this.$jQuery('body').on('focus', 'input[type=number]', function (e) {\n            $(this).on('wheel', function (e) {\n                e.preventDefault();\n            });\n        });\n    },\n    data() {\n        return {\n            langSession: null,\n            loanRepaymentForm: {\n                disbursementId: \"\",\n                currencyId: \"\",\n                repaymentDate: moment().toDate(),\n                paid: 0,\n                penalty: 0,\n                penaltyPaid: 0,\n                voucher: \"\",\n                note: \"\",\n                clientId: \"\",\n                type: \"Repayment\",\n                interestPaid: 0,\n                operationFeePaid: 0,\n                interestReminderChargePaid: 0,\n                interestReminderCharge: 0,\n                _id: \"\"\n            },\n            rules: {},\n            disbursementOption: [],\n            currencyOption: [\n                {label: \"USD\", value: \"USD\"},\n                {label: \"KHR\", value: \"KHR\"},\n                {label: \"THB\", value: \"THB\"},\n            ],\n            typeIdentity: \"Identity Card\",\n            repaymentDoc: {},\n            skip: 0,\n            currencySymbol: \"\",\n            currencyId: \"\",\n            dayLate: 0,\n            balance: 0,\n            balanceNeedToPaidShow: 0,\n            isFee: false,\n            isPrepay: false,\n            isPayOff: false,\n            isDisablePenalty: false,\n            isDisablePaid: false,\n            isPenaltyMinusGraceDay: true,\n            interestReminder: 0,\n            interestReminderSumDay: 0,\n            operationFeeReminder: 0,\n            isOperationFee: false\n        }\n    },\n    watch: {\n        \"loanRepaymentForm.disbursementId\"(val) {\n            this.getDisbursementById(val);\n        },\n        \"loanRepaymentForm.repaymentDate\"(val) {\n            this.getVoucherByRoleAndDate(val);\n            this.loanRepaymentForm.repaymentDate = val;\n            this.getDisbursementById(this.loanRepaymentForm.disbursementId);\n        },\n        \"loanRepaymentForm.type\"(val) {\n            this.loanRepaymentForm.type = val;\n            this.getDisbursementById(this.loanRepaymentForm.disbursementId);\n        }\n    },\n    methods: {\n        customerOpt(query) {\n            if (!!query) {\n                setTimeout(() => {\n                    Meteor.call('queryLoanDisbursementOption', query, Session.get(\"area\"), (err, result) => {\n                        if (!err) {\n                            this.disbursementOption = result;\n                        } else {\n                            console.log(err.message);\n                        }\n                    })\n                }, 200);\n            } else {\n                Meteor.call('queryLoanDisbursementOption', \"\", Session.get(\"area\"), (err, result) => {\n                    if (!err) {\n                        this.disbursementOption = result;\n                    } else {\n                        console.log(err.message);\n                    }\n                })\n            }\n        },\n        getCalculateAmountPaid(disbursementId) {\n            let vm = this;\n            Meteor.call(\"getAmountNeedToPaid\", disbursementId, moment(vm.loanRepaymentForm.repaymentDate).endOf(\"day\").toDate(), (err, result) => {\n                if (result) {\n                    vm.repaymentDoc = result;\n                    vm.typeIdentity = result && result.clientDoc && result.clientDoc.type || \"Identity Card\";\n\n                    vm.loanRepaymentForm.clientId = result.clientId;\n\n                    if (vm.loanRepaymentForm.repaymentDate && result.date) {\n                        vm.dayLate = moment(vm.loanRepaymentForm.repaymentDate).startOf(\"days\").add(12, \"hours\").diff(result.date, \"days\");\n                    }\n                    vm.dayLate = vm.dayLate > 0 ? vm.dayLate : 0;\n\n                    if (result && result.penaltyDoc && vm.dayLate > result.penaltyDoc.graceDay) {\n                        let penaltyPerday;\n                        if (result.currencyId === \"USD\") {\n                            penaltyPerday = result.penaltyDoc.amountUSD;\n                        } else if (result.currencyId === \"KHR\") {\n                            penaltyPerday = result.penaltyDoc.amountKHR;\n                        } else if (result.currencyId === \"THB\") {\n                            penaltyPerday = result.penaltyDoc.amountTHB;\n                        }\n\n                        if (this.isPenaltyMinusGraceDay === true) {\n                            if (result.penaltyDoc.type === \"A\") {\n                                vm.loanRepaymentForm.penalty = formatCurrencyLast((vm.dayLate - result.penaltyDoc.graceDay) * penaltyPerday, result.currencyId);\n                            } else if (result.penaltyDoc.type === \"P\") {\n                                vm.loanRepaymentForm.penalty = formatCurrencyLast((vm.dayLate - result.penaltyDoc.graceDay) * (penaltyPerday * result.principleUnpaid / 100), result.currencyId);\n                            }\n                        } else {\n                            if (result.penaltyDoc.type === \"A\") {\n                                vm.loanRepaymentForm.penalty = formatCurrencyLast((vm.dayLate) * penaltyPerday, result.currencyId);\n                            } else if (result.penaltyDoc.type === \"P\") {\n                                vm.loanRepaymentForm.penalty = formatCurrencyLast((vm.dayLate) * (penaltyPerday * result.principleUnpaid / 100), result.currencyId);\n                            }\n                        }\n                    } else {\n                        vm.loanRepaymentForm.penalty = 0;\n                    }\n\n\n                    vm.currencySymbol = getCurrencySymbolById(result && result.currencyId);\n                    vm.currencyId = result.currencyId;\n                    vm.loanRepaymentForm.penaltyPaid = vm.$_numeral(vm.loanRepaymentForm.penalty).value();\n                    vm.loanRepaymentForm.paid = vm.$_numeral(formatCurrencyLast(result.balanceUnpaid || 0, result.currencyId)).value();\n                    this.getTotal();\n                }\n            })\n        },\n        getCalculatePrepayPaid(disbursementId) {\n            let vm = this;\n            Meteor.call(\"getPrepayToPaid\", disbursementId, moment(vm.loanRepaymentForm.repaymentDate).endOf(\"day\").toDate(), (err, result) => {\n                if (result) {\n                    vm.isPrepay = true;\n                    vm.repaymentDoc = result;\n                    vm.typeIdentity = result && result.clientDoc && result.clientDoc.type || \"Identity Card\";\n                    vm.loanRepaymentForm.clientId = result.clientId;\n\n                    vm.dayLate = 0;\n                    vm.loanRepaymentForm.penalty = 0;\n                    vm.currencySymbol = getCurrencySymbolById(result && result.currencyId);\n                    vm.currencyId = result.currencyId;\n                    vm.loanRepaymentForm.penaltyPaid = 0;\n                    vm.loanRepaymentForm.paid = vm.$_numeral(formatCurrencyLast(result.balanceUnpaid || 0, result.currencyId)).value();\n                    this.getTotal();\n                }\n            })\n        },\n        getCalculateClosingPaid(disbursementId) {\n            let vm = this;\n            Meteor.call(\"getClosingPaid\", disbursementId, moment(vm.loanRepaymentForm.repaymentDate).endOf(\"day\").toDate(), (err, result) => {\n                if (result) {\n                    vm.repaymentDoc = result;\n                    vm.typeIdentity = result && result.clientDoc && result.clientDoc.type || \"Identity Card\";\n                    vm.loanRepaymentForm.clientId = result.clientId;\n\n                    vm.loanRepaymentForm.penalty = 0;\n                    vm.currencySymbol = getCurrencySymbolById(result && result.currencyId);\n                    vm.currencyId = result.currencyId;\n\n                    let totalPayOff = 0;\n                    totalPayOff += (result.principleUnpaid || 0);\n                    if (result.isAllowClosing === false) {\n                        let penaltyInterest = result.penaltyClosingDoc.interestReminderCharge * result.interestUnpaid / 100;\n                        vm.loanRepaymentForm.interestReminderChargePaid = vm.$_numeral(formatCurrencyLast(penaltyInterest, result.currencyId)).value();\n                        vm.loanRepaymentForm.interestReminderCharge = formatCurrencyLast(penaltyInterest, result.currencyId);\n                    }\n\n\n                    if (vm.loanRepaymentForm.repaymentDate && result.date) {\n                        vm.dayLate = moment(vm.loanRepaymentForm.repaymentDate).startOf(\"days\").add(12, \"hours\").diff(result.date, \"days\");\n                    }\n\n                    let interestPerDay = result.interestReminder / result.dayRange;\n                    let dayForInterest = vm.dayLate > 0 ? result.dayRange : result.dayRange + vm.dayLate;\n                    vm.dayLate = vm.dayLate > 0 ? vm.dayLate : 0;\n\n\n                    let intRemind = 0;\n                    let countFirstUnpaid = 0;\n                    result.scheduleList.forEach((obj) => {\n                        let dayLateInLine = moment(vm.loanRepaymentForm.repaymentDate).startOf(\"days\").add(12, \"hours\").diff(obj.date, \"days\");\n                        if (dayLateInLine > 0) {\n                            let interestPerDay = obj.interestUnpaid / obj.dayRange;\n                            intRemind += interestPerDay * dayLateInLine;\n                        }\n                        if (obj.isPaid === false && countFirstUnpaid === 0) {\n                            vm.operationFeeReminder = obj.operationFeeUnpaid;\n                            countFirstUnpaid++;\n                        }\n                    })\n\n\n                    dayForInterest = dayForInterest > 0 ? dayForInterest : 0;\n                    vm.interestReminder = result.interestReminder + intRemind;\n                    vm.interestReminderSumDay = interestPerDay * dayForInterest + intRemind;\n\n\n                    vm.interestReminder = formatCurrencyLast(vm.repaymentDoc.interestUnpaid > vm.interestReminder ? vm.interestReminder : vm.repaymentDoc.interestUnpaid, result.currencyId);\n                    vm.interestReminderSumDay = formatCurrencyLast(vm.repaymentDoc.interestUnpaid > vm.interestReminderSumDay ? vm.interestReminderSumDay : vm.repaymentDoc.interestUnpaid, result.currencyId);\n\n                    vm.loanRepaymentForm.interestPaid = vm.$_numeral(formatCurrencyLast(vm.interestReminder, result.currencyId)).value();\n                    vm.loanRepaymentForm.operationFeePaid = vm.operationFeeReminder;\n\n                    if (result && result.penaltyDoc && vm.dayLate > result.penaltyDoc.graceDay) {\n                        let penaltyPerday;\n                        if (result.currencyId === \"USD\") {\n                            penaltyPerday = result.penaltyDoc.amountUSD;\n                        } else if (result.currencyId === \"KHR\") {\n                            penaltyPerday = result.penaltyDoc.amountKHR;\n                        } else if (result.currencyId === \"THB\") {\n                            penaltyPerday = result.penaltyDoc.amountTHB;\n                        }\n\n                        if (result.penaltyDoc.type === \"A\") {\n                            vm.loanRepaymentForm.penalty = formatCurrencyLast((vm.dayLate - result.penaltyDoc.graceDay) * penaltyPerday, result.currencyId);\n                        } else if (result.penaltyDoc.type === \"P\") {\n                            vm.loanRepaymentForm.penalty = formatCurrencyLast((vm.dayLate - result.penaltyDoc.graceDay) * (penaltyPerday * result.principleUnpaid / 100), result.currencyId);\n                        }\n                    } else {\n                        vm.loanRepaymentForm.penalty = 0;\n                    }\n\n                    vm.loanRepaymentForm.penaltyPaid = vm.$_numeral(vm.loanRepaymentForm.penalty).value();\n                    vm.loanRepaymentForm.paid = vm.$_numeral(formatCurrencyLast(totalPayOff, result.currencyId)).value();\n                    this.getTotal();\n                }\n            })\n        },\n        getCalculateWriteOff(disbursementId) {\n            let vm = this;\n            Meteor.call(\"getWriteOff\", disbursementId, moment(vm.loanRepaymentForm.repaymentDate).endOf(\"day\").toDate(), (err, result) => {\n                if (result) {\n                    vm.repaymentDoc = result;\n                    vm.typeIdentity = result && result.clientDoc && result.clientDoc.type || \"Identity Card\";\n                    vm.loanRepaymentForm.clientId = result.clientId;\n\n                    if (vm.loanRepaymentForm.repaymentDate && result.date) {\n                        vm.dayLate = moment(vm.loanRepaymentForm.repaymentDate).startOf(\"days\").add(12, \"hours\").diff(result.date, \"days\");\n                    }\n                    vm.dayLate = vm.dayLate > 0 ? vm.dayLate : 0;\n\n                    vm.currencySymbol = getCurrencySymbolById(result && result.currencyId);\n                    vm.currencyId = result.currencyId;\n                    vm.loanRepaymentForm.penaltyPaid = 0;\n                    vm.loanRepaymentForm.paid = vm.$_numeral(formatCurrencyLast(result.balanceUnpaid || 0, result.currencyId)).value();\n                    this.getTotal();\n                }\n            })\n        },\n        getCalculateFeePaid(disbursementId) {\n            let vm = this;\n            Meteor.call(\"getFeeNeedToPaid\", disbursementId, (err, result) => {\n                if (result) {\n                    vm.repaymentDoc = result;\n                    vm.typeIdentity = result && result.clientDoc && result.clientDoc.type || \"Identity Card\";\n                    vm.loanRepaymentForm.clientId = result.clientId;\n                    vm.dayLate = 0;\n                    vm.loanRepaymentForm.penalty = 0;\n\n\n                    vm.currencySymbol = getCurrencySymbolById(result && result.currencyId);\n                    vm.currencyId = result.currencyId;\n\n                    vm.loanRepaymentForm.paid = vm.$_numeral(formatCurrencyLast(result.feeAmount || 0, result.currencyId)).value();\n\n                    vm.getTotal();\n                }\n            })\n        },\n        getTotal() {\n            let vm = this;\n            vm.balanceNeedToPaidShow = formatCurrencyLast((vm.loanRepaymentForm.operationFeePaid || 0) + (vm.loanRepaymentForm.penaltyPaid || 0) + (vm.loanRepaymentForm.paid || 0) + (vm.loanRepaymentForm.interestPaid || 0) + (vm.loanRepaymentForm.interestReminderChargePaid || 0), vm.repaymentDoc.currencyId);\n        },\n        getVoucherByRoleAndDate(date) {\n            let vm = this;\n            Meteor.call(\"loan_getVoucherNoByRoleAndDate\", Session.get(\"area\"), date, (err, result) => {\n                if (!err) {\n                    vm.loanRepaymentForm.voucher = result;\n                }\n            })\n        },\n        getDisbursementById(id) {\n            let vm = this;\n            Meteor.call(\"queryLoanDisbursementById\", id, (err, result) => {\n                if (result) {\n                    vm.isFee = math.round(result.feeAmount - result.paidFeeAmount) > 0;\n                    if (vm.isFee === true) {\n                        vm.repaymentDoc.disbursementDoc = result;\n                        vm.dayLate = 0;\n                        vm.getCalculateFeePaid(id);\n                        vm.loanRepaymentForm.type = \"Fee\";\n                        vm.isDisablePaid = true;\n                        vm.isDisablePenalty = true;\n                    } else {\n                        if (vm.loanRepaymentForm.type === \"Repayment\") {\n                            vm.getCalculateAmountPaid(id);\n                            vm.isDisablePaid = false;\n                            vm.isDisablePenalty = false;\n                            vm.isPayOff = false;\n                            vm.isPrepay = false;\n\n\n                            vm.loanRepaymentForm.operationFeePaid = 0;\n                            vm.loanRepaymentForm.interestPaid = 0;\n                            vm.loanRepaymentForm.interestReminderCharge = 0;\n                            vm.loanRepaymentForm.interestReminderChargePaid = 0;\n\n                        } else if (vm.loanRepaymentForm.type === \"Write Off\") {\n                            vm.getCalculateWriteOff(id);\n                            vm.isDisablePaid = true;\n                            vm.isDisablePenalty = true;\n                            vm.isPayOff = false;\n                            vm.isPrepay = false;\n\n                            vm.loanRepaymentForm.type = \"Write Off\";\n\n                            vm.loanRepaymentForm.operationFeePaid = 0;\n                            vm.loanRepaymentForm.interestPaid = 0;\n                            vm.loanRepaymentForm.interestReminderCharge = 0;\n                            vm.loanRepaymentForm.interestReminderChargePaid = 0;\n\n                        } else if (vm.loanRepaymentForm.type === \"Prepay\") {\n                            vm.isDisablePaid = false;\n                            vm.isDisablePenalty = true;\n                            vm.getCalculatePrepayPaid(id);\n                            vm.isPayOff = false;\n                            vm.isPrepay = true;\n\n                            vm.loanRepaymentForm.operationFeePaid = 0;\n                            vm.loanRepaymentForm.interestPaid = 0;\n                            vm.loanRepaymentForm.interestReminderCharge = 0;\n                            vm.loanRepaymentForm.interestReminderChargePaid = 0;\n\n                        } else if (vm.loanRepaymentForm.type === \"Pay Off\") {\n                            vm.getCalculateClosingPaid(id);\n                            vm.isDisablePaid = true;\n                            vm.isDisablePenalty = false;\n                            vm.loanRepaymentForm.type = \"Pay Off\";\n                            vm.isPayOff = true;\n                            vm.isPrepay = false;\n\n\n                        } else {\n                            if (vm.isFee === false) {\n                                vm.getCalculateAmountPaid(id);\n                                vm.loanRepaymentForm.type = \"Repayment\";\n                                vm.isDisablePaid = false;\n                                vm.isDisablePenalty = false;\n                                vm.isPayOff = false;\n                                vm.isPrepay = false;\n\n                                vm.loanRepaymentForm.operationFeePaid = 0;\n                                vm.loanRepaymentForm.interestPaid = 0;\n                                vm.loanRepaymentForm.interestReminderCharge = 0;\n                                vm.loanRepaymentForm.interestReminderChargePaid = 0;\n\n                            }\n                        }\n\n                    }\n                }\n            })\n        },\n        saveLoanRepayment(event) {\n            event.preventDefault();\n            let vm = this;\n            if (vm.loanRepaymentForm.type === \"Pay Off\") {\n                if (vm.dayLate > 0 && vm.repaymentDoc.installmentList.length != 1) {\n                    vm.$message({\n                        duration: 5000,\n                        message: this.langConfig['cannotPayOffThisTime'],\n                        type: 'error'\n                    });\n                    return false;\n                }\n            }\n\n            this.$refs[\"loanRepaymentForm\"].validate((valid) => {\n                if (valid) {\n                    let loanRepaymentDoc = {\n                        disbursementId: vm.loanRepaymentForm.disbursementId,\n                        currencyId: vm.repaymentDoc.currencyId,\n                        repaymentDate: moment(vm.loanRepaymentForm.repaymentDate).startOf(\"days\").add(12, \"hours\").toDate(),\n                        remain: vm.$_numeral(vm.loanRepaymentForm.remain).value(),\n                        penalty: vm.$_numeral(vm.loanRepaymentForm.penalty).value(),\n                        penaltyPaid: vm.$_numeral(vm.loanRepaymentForm.penaltyPaid).value(),\n                        voucher: vm.loanRepaymentForm.voucher,\n                        note: vm.loanRepaymentForm.note,\n                        type: vm.loanRepaymentForm.type,\n                        dayLate: vm.dayLate,\n                        interestReminderCharge: vm.$_numeral(vm.loanRepaymentForm.interestReminderCharge).value(),\n                        interestReminderChargePaid: vm.$_numeral(vm.loanRepaymentForm.interestReminderChargePaid).value(),\n                        interestPaid: vm.$_numeral(vm.loanRepaymentForm.interestPaid).value(),\n                        operationFeePaid: vm.$_numeral(vm.loanRepaymentForm.operationFeePaid).value(),\n                        clientId: vm.loanRepaymentForm.clientId,\n                        paid: vm.$_numeral(vm.loanRepaymentForm.paid).value(),\n                        totalPaid: vm.$_numeral(vm.loanRepaymentForm.paid + vm.loanRepaymentForm.penaltyPaid + vm.loanRepaymentForm.interestReminderChargePaid + vm.loanRepaymentForm.interestPaid + vm.loanRepaymentForm.operationFeePaid).value(),\n                        rolesArea: Session.get('area')\n                    };\n\n                    Meteor.call(\"insertLoanRepayment\", loanRepaymentDoc, (err, result) => {\n                        if (!err) {\n                            vm.$message({\n                                duration: 1000,\n                                message: this.langConfig['saveSuccess'],\n                                type: 'success'\n                            });\n                            vm.resetForm();\n                        } else {\n                            vm.$message({\n                                duration: 1000,\n                                message: err.message,\n                                type: 'error'\n                            });\n                        }\n                    })\n                }\n            })\n\n        },\n        getRemainAmountByCurrency(currency, usd, khr, thb) {\n            if (currency === \"USD\") {\n                return usd;\n            } else if (currency === \"KHR\") {\n                return khr;\n            } else if (currency === \"THB\") {\n                return thb;\n            }\n        },\n        cancel() {\n            this.$message({\n                type: 'info',\n                message: this.langConfig['cancel']\n            });\n        },\n        resetForm() {\n            this.loanRepaymentForm.disbursementId = \"\";\n            this.loanRepaymentForm.repaymentDate = moment().toDate();\n            this.loanRepaymentForm.paid = 0;\n\n            this.loanRepaymentForm.remain = 0;\n            this.loanRepaymentForm.penalty = 0;\n            this.loanRepaymentForm.penaltyPaid = 0;\n            this.balanceNeedToPaidShow = 0;\n\n            this.loanRepaymentForm.interestPaid = 0;\n            this.loanRepaymentForm.operationFeePaid = 0;\n            this.loanRepaymentForm.interestReminderCharge = 0;\n            this.loanRepaymentForm.interestReminderChargePaid = 0;\n            this.interestReminder = 0;\n\n            this.loanRepaymentForm.note = \"\";\n            this.repaymentDoc = {};\n\n        }\n    },\n    created() {\n        this.customerOpt();\n        this.getVoucherByRoleAndDate(moment().toDate());\n\n        let setupDoc = WB_waterBillingSetup.findOne({});\n        this.isOperationFee = setupDoc.isOperationFee;\n        this.isPenaltyMinusGraceDay = setupDoc.isPenaltyMinusGraceDay;\n\n    },\n    computed: {\n        langConfig() {\n            let data = compoLang.filter(config => config.lang === this.langSession)[0]['repayment'];\n            return data;\n        }\n    }\n}\n"]},"sourceType":"script","hash":"82f9d53e72f14f7cb34ee916a7c7e23411574735"}
